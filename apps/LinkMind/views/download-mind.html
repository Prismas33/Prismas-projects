<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkMind - Buscar Ideias</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#4f46e5">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1><a href="/dashboard">üß† LinkMind</a></h1>
                <nav>
                    <a href="/dashboard" class="btn btn-secondary">‚Üê Voltar</a>
                </nav>
            </div>
        </header>

        <main class="download-mind">
            <div class="search-container">
                <h2>üîç Buscar Ideias</h2>
                <p>Encontre suas anota√ß√µes e projetos salvos</p>

                <div class="search-form">
                    <div class="search-input-container">
                        <input type="text" id="searchInput" placeholder="Digite para buscar suas ideias..." autocomplete="off">
                        <button id="searchBtn" class="search-btn">üîç</button>
                    </div>
                    
                    <div class="search-filters">
                        <select id="sortBy">
                            <option value="recent">Mais Recentes</option>
                            <option value="oldest">Mais Antigas</option>
                            <option value="title">Por T√≠tulo</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="results-container">
                <div id="searchResults" class="ideas-grid">
                    <div class="loading">Carregando suas ideias...</div>
                </div>
                
                <div id="noResults" class="no-results">
                    <div class="no-results-icon">üí≠</div>
                    <h3>Nenhuma ideia encontrada</h3>
                    <p>Tente usar palavras-chave diferentes ou <a href="/upload-mind">crie sua primeira ideia</a></p>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const sortBy = document.getElementById('sortBy');
            const resultsContainer = document.getElementById('searchResults');
            const noResultsDiv = document.getElementById('noResults');
            
            let allIdeas = [];
            let searchTimeout;

            // Carregar todas as ideias inicialmente
            async function loadIdeas(searchTerm = '') {
                try {
                    resultsContainer.innerHTML = '<div class="loading">Buscando ideias...</div>';
                    noResultsDiv.style.display = 'none';

                    let url = '/api/ideas';
                    if (searchTerm) {
                        url += `?search=${encodeURIComponent(searchTerm)}`;
                    }

                    const response = await fetch(url);
                    if (response.ok) {
                        const data = await response.json();
                        allIdeas = data.ideas;
                        displayIdeas(allIdeas);
                    } else {
                        resultsContainer.innerHTML = '<div class="error">Erro ao carregar ideias</div>';
                    }
                } catch (error) {
                    console.error('Erro ao carregar ideias:', error);
                    resultsContainer.innerHTML = '<div class="error">Erro de conex√£o</div>';
                }
            }

            // Exibir ideias
            function displayIdeas(ideas) {
                if (ideas.length === 0) {
                    resultsContainer.innerHTML = '';
                    noResultsDiv.style.display = 'block';
                    return;
                }

                noResultsDiv.style.display = 'none';
                
                const ideasHTML = ideas.map(idea => `
                    <div class="idea-card" data-id="${idea.id}">
                        <div class="idea-header">
                            <h3>${escapeHtml(idea.title)}</h3>
                            <div class="idea-actions">
                                <button class="action-btn edit-btn" title="Editar">‚úèÔ∏è</button>
                                <button class="action-btn delete-btn" title="Excluir">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <p class="idea-description">${escapeHtml(idea.description)}</p>
                        
                        ${idea.startDate || idea.endDate ? `
                            <div class="idea-dates">
                                ${idea.startDate ? `<span>In√≠cio: ${formatDate(idea.startDate)}</span>` : ''}
                                ${idea.endDate ? `<span>Fim: ${formatDate(idea.endDate)}</span>` : ''}
                            </div>
                        ` : ''}
                        
                        <div class="idea-footer">
                            <small>Criado em: ${formatDate(idea.createdAt)}</small>
                        </div>
                    </div>
                `).join('');

                resultsContainer.innerHTML = ideasHTML;

                // Adicionar event listeners para os bot√µes de a√ß√£o
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', handleEdit);
                });

                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', handleDelete);
                });
            }

            // Busca em tempo real
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim();
                
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    if (searchTerm.length >= 2 || searchTerm.length === 0) {
                        loadIdeas(searchTerm);
                    }
                }, 500);
            });

            // Bot√£o de busca
            searchBtn.addEventListener('click', function() {
                const searchTerm = searchInput.value.trim();
                loadIdeas(searchTerm);
            });

            // Ordena√ß√£o
            sortBy.addEventListener('change', function() {
                sortIdeas(this.value);
            });

            // Ordenar ideias
            function sortIdeas(sortType) {
                let sortedIdeas = [...allIdeas];
                
                switch(sortType) {
                    case 'recent':
                        sortedIdeas.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        break;
                    case 'oldest':
                        sortedIdeas.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                        break;
                    case 'title':
                        sortedIdeas.sort((a, b) => a.title.localeCompare(b.title));
                        break;
                }
                
                displayIdeas(sortedIdeas);
            }

            // Editar ideia (simulado - redirecionaria para uma p√°gina de edi√ß√£o)
            function handleEdit(e) {
                const ideaCard = e.target.closest('.idea-card');
                const ideaId = ideaCard.dataset.id;
                const title = ideaCard.querySelector('h3').textContent;
                
                if (confirm(`Editar a ideia "${title}"?\n\n(Funcionalidade de edi√ß√£o seria implementada aqui)`)) {
                    // Aqui implementaria a l√≥gica de edi√ß√£o
                    alert('Funcionalidade de edi√ß√£o em desenvolvimento!');
                }
            }

            // Excluir ideia
            async function handleDelete(e) {
                const ideaCard = e.target.closest('.idea-card');
                const ideaId = ideaCard.dataset.id;
                const title = ideaCard.querySelector('h3').textContent;
                
                if (confirm(`Tem certeza que deseja excluir a ideia "${title}"?`)) {
                    try {
                        // Aqui implementaria a API de delete
                        // const response = await fetch(`/api/ideas/${ideaId}`, { method: 'DELETE' });
                        
                        // Simula√ß√£o da exclus√£o
                        ideaCard.style.opacity = '0.5';
                        setTimeout(() => {
                            ideaCard.remove();
                            allIdeas = allIdeas.filter(idea => idea.id !== ideaId);
                            
                            if (allIdeas.length === 0) {
                                noResultsDiv.style.display = 'block';
                            }
                        }, 300);
                        
                        alert('Ideia exclu√≠da! (Simula√ß√£o - API de delete seria implementada)');
                    } catch (error) {
                        alert('Erro ao excluir ideia');
                    }
                }
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Carregar ideias iniciais
            loadIdeas();

            // Enter para buscar
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = this.value.trim();
                    loadIdeas(searchTerm);
                }
            });
        });
    </script>
</body>
</html>
