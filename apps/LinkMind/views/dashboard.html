<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>LinkMind - Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <meta name="theme-color" content="#4f46e5">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>üß† LinkMind</h1>                <div class="user-info">
                    <span id="userName">Carregando...</span>
                    <button id="settingsBtn" class="btn btn-outline" title="Configura√ß√µes">‚öôÔ∏è</button>
                    <button id="logoutBtn" class="btn btn-secondary">Sair</button>
                </div>
            </div>
        </header>

        <main class="dashboard">
            <div class="welcome-section">
                <h2>Bem-vindo de volta!</h2>
                <p>Organize suas ideias e mantenha sua mente conectada.</p>
            </div>

            <div class="actions-grid">
                <div class="action-card">
                    <div class="action-icon">üí°</div>
                    <h3>Adicionar Ideia</h3>
                    <p>Capture uma nova inspira√ß√£o ou projeto</p>
                    <a href="/upload-mind" class="btn btn-primary">Nova Ideia</a>
                </div>

                <div class="action-card">
                    <div class="action-icon">üîç</div>
                    <h3>Buscar Ideias</h3>
                    <p>Encontre suas anota√ß√µes e projetos salvos</p>
                    <a href="/download-mind" class="btn btn-primary">Buscar</a>
                </div>
            </div>

            <div class="recent-section">
                <h3>Ideias Recentes</h3>
                <div id="recentIdeas" class="ideas-list">
                    <div class="loading">Carregando ideias...</div>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/app.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="/js/firebase-config.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const userNameElement = document.getElementById('userName');
            const logoutBtn = document.getElementById('logoutBtn');
            const settingsBtn = document.getElementById('settingsBtn');
            const recentIdeasContainer = document.getElementById('recentIdeas');

            // Carregar dados do usu√°rio
            try {
                const userResponse = await fetch('/api/user');
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    userNameElement.textContent = userData.name;
                } else {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Erro ao carregar dados do usu√°rio:', error);
                window.location.href = '/';
            }

            // Carregar ideias recentes
            try {
                const ideasResponse = await fetch('/api/ideas?limit=5');
                if (ideasResponse.ok) {
                    const data = await ideasResponse.json();
                    displayRecentIdeas(data.ideas);
                } else {
                    recentIdeasContainer.innerHTML = '<p>Erro ao carregar ideias recentes</p>';
                }
            } catch (error) {
                console.error('Erro ao carregar ideias:', error);
                recentIdeasContainer.innerHTML = '<p>Erro ao carregar ideias recentes</p>';
            }

            // Event Listeners
            logoutBtn.addEventListener('click', logout);
            settingsBtn.addEventListener('click', () => {
                window.location.href = '/settings';
            });

            function logout() {
                fetch('/api/logout', { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = '/';
                        } else {
                            console.error('Erro ao fazer logout');
                        }
                    })
                    .catch(error => console.error('Erro ao fazer logout:', error));
            }

            function displayRecentIdeas(ideas) {
                if (ideas.length === 0) {
                    recentIdeasContainer.innerHTML = '<p class="no-ideas">Nenhuma ideia encontrada. Que tal criar a primeira?</p>';
                    return;
                }

                const ideasHTML = ideas.slice(0, 3).map(idea => `
                    <div class="idea-item">
                        <h4>${escapeHtml(idea.title)}</h4>
                        <p>${escapeHtml(idea.description.substring(0, 100))}${idea.description.length > 100 ? '...' : ''}</p>
                        <small>Criado em: ${new Date(idea.createdAt).toLocaleDateString('pt-BR')}</small>
                    </div>
                `).join('');

                recentIdeasContainer.innerHTML = ideasHTML;
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        });
    </script>
</body>
</html>
